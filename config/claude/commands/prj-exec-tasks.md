---
description: プロジェクトのタスクを体系的に実行する
argument-hint: --until=[タスク名またはタスクID] (optional)
---

## 前提・背景

- プロジェクトには体系的なドキュメント構造が存在する
  - REQUIREMENTS.md: プロジェクトの要件定義
  - DESIGN.md: 技術設計とアーキテクチャ方針
  - TASKS.md: 実装タスクの一覧と詳細（タスクは優先順位順にチェックリスト形式で記載されている）
  - CLAUDE.md / AGENTS.md (optional): 実行規約とエージェント使用方針
- タスク実行時はドキュメント間の一貫性を保つ必要がある
- TASKS.mdのタスク単位でcommitする（サブタスク完了時ではない）
- 各タスク完了時にTASKS.mdの該当項目にチェックマークを入れる
- テストの通過確認が必須である
- `--until`引数が指定された場合は、未完了タスクを順に実行し、指定タスク完了まで継続する
- `--until`引数が未指定の場合は、全ての未完了タスクを実行する

## タスク

実行するべきタスクを以下に示す。
内容をよく読み、複数並行して進められると判断した場合は、並行して実行すること。

### タスク実行準備

- TASKS.mdの存在を確認し、タスク一覧を取得する
- 未完了タスクをリストアップする
- `--until`引数が指定されている場合:
  - 該当タスクが存在するか確認する
  - 該当タスクまでの未完了タスクを実行対象として特定する
- `--until`引数が未指定の場合:
  - 全ての未完了タスクを実行対象として特定する
- 実行対象タスクをユーザーに提示し、実行計画を確認する

### タスク実行ループ

実行対象タスクそれぞれに対して、以下を順次実行する:

1. タスクの詳細情報(目的、要件、成果物など)を読み取る
2. REQUIREMENTS.mdでタスクに関連する要件定義を確認し、整合性を検証する
3. DESIGN.mdでタスクに関連する設計方針を確認し、実装方針を決定する
4. CLAUDE.md / AGENTS.mdが存在する場合、実行規約とエージェント使用方針を確認する
5. TodoWriteツールでタスクを実行可能なサブタスクに分解し、進捗管理を開始する
6. 各サブタスクを段階的に実行する
   - コード実装（規約ドキュメントに従い、定義されたエージェントを適宜活用する）
   - 関連テストの実行と通過確認
   - コーディング規約への準拠確認
7. 全サブタスクが完了したら、TASKS.md内の該当タスク項目にチェックマーク(`[x]`)を入れる
8. タスクの変更内容で`/commit-it`を実行してcommitする
9. 次のタスクへ移行する（`--until`で指定されたタスクに到達した場合はループを終了する）

## 完了条件

タスクの完了条件は以下の通りとする。
完了条件、または次の項目で述べる中断条件を満たすまで作業を継続すること。

- `--until`引数が指定されている場合:
  - 指定されたタスクまでの全未完了タスクが完全に実装されている
  - 指定されたタスク自身も完了している
- `--until`引数が未指定の場合:
  - TASKS.md内の全未完了タスクが完全に実装されている
- 各完了タスクについて:
  - 要件定義(REQUIREMENTS.md)に適合している
  - 設計方針(DESIGN.md)に従っている
  - 関連する全てのテストが通過している
  - コードが既存のコーディング規約に準拠している
  - TASKS.md内の該当項目にチェックマーク(`[x]`)が入っている
  - タスク単位で適切なcommitが作成されている
  - TodoWriteで管理された全サブタスクが完了している

## 実行規約

タスクの実行中は常に以下の規約に従え。

- CLAUDE.md / AGENTS.mdに記載された全ての規約を遵守する
- TodoWriteツールで進捗を可視化し、段階的に作業を進める
- TASKS.mdのタスク単位で作業を完了させ、commitする（サブタスク単位ではcommitしない）
- タスク完了時は必ずTASKS.mdの該当項目にチェックマークを入れてからcommitする
- タスク実行前に必ずREQUIREMENTS.mdとDESIGN.mdを参照し、方針を確認する
- 一つのタスクに含まれる変更は、単一のcommitにまとめる
- 複数種類の変更(feat, fix, refactorなど)が混在する場合でも、TASKS.mdのタスク単位でcommitする

## 中断条件

以下の条件を満たした場合は作業を中断し、その旨を報告すること。
また、現在の状況と残タスクを簡潔にまとめて提示すること。

- 必須ドキュメント(TASKS.md)が存在しない場合
- TASKS.mdに該当するタスクが存在しない場合
- `--until`で指定されたタスクがTASKS.mdに存在しない場合
- タスクの要件や設計に矛盾がある場合
- 作業を繰り返す中で、進捗が認められなくなった場合
- テストが継続的に失敗し、解決の見込みが立たない場合
- プロジェクトドキュメント間で矛盾を発見した場合

## 禁止事項

- タスクに直接関係しないファイルの変更を禁じる
- プロジェクトドキュメント(REQUIREMENTS.md、DESIGN.md、TASKS.md、CLAUDE.md / AGENTS.md)の参照を省略することを禁じる
- CLAUDE.md / AGENTS.mdに記載された禁止事項に違反することを禁じる

## 補足事項

タスクに関する補足事項を以下に示す。

- タスクを実行するにあたり、その円滑な進行を妨げる点(不明瞭な指示、必要不可欠な情報の欠損など)がある場合は、その旨をユーザーに報告し、追加の情報を求めよ
- optionalドキュメント(REQUIREMENTS.md、DESIGN.md、CLAUDE.md / AGENTS.md)が存在しない場合は、TASKS.mdの情報のみで実行可能かを判断し、不可能な場合は中断すること
- タスクの依存関係が存在する場合は、依存タスクの完了を確認してから実行すること
- 各タスクのcommitメッセージは、タスクの目的と変更内容を明確に示すこと
- `--until`引数で指定するタスクは、タスク名またはタスクIDのいずれでも指定可能である
