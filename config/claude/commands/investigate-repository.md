---
description: リポジトリ内の特定実装の詳細調査と分析
argument-hint: <対象のファイルパス、クラス名、関数名、または機能名> --out <調査結果の出力先ファイルパス>
allowed-tools: Bash, Bash(git log:*), Bash(git blame:*)
---

## 前提・背景

リポジトリ内の特定の実装について、その構造、依存関係、拡張性を詳細に調査し、今後の開発に有用な情報を提供する。

### 現在のリポジトリ状態
- Git状態: !`git status --porcelain | head -5`
- 最新コミット: !`git log --oneline -1`
- 言語構成: !`find . -name "*.md" -o -name "*.json" -o -name "*.js" -o -name "*.ts" -o -name "*.py" | grep -E '\.(md|json|js|ts|py)$' | sed 's/.*\.//' | sort | uniq -c | sort -rn | head -5`

## タスク

実行するべきタスクを以下に示す。
内容をよく読み、複数並行して進められると判断した場合は、並行して実行すること。
調査結果は <調査結果の出力先ファイルパス> に Markdown 形式で保存すること。

### 1. 実装の特定と基本分析
- 指定された実装($ARGUMENTS)の正確な位置を特定せよ
- ファイル構造と命名規則を確認せよ
- 実装の規模（行数、複雑度）を測定せよ

### 2. 構造と動作の詳細分析
- 主要な関数・メソッドの責務を明確化せよ
- データフローと制御フローを図式化せよ
- エラーハンドリングとエッジケースの処理を検証せよ

### 3. 依存関係の調査
- 直接的な依存（import/require）を列挙せよ
- 間接的な依存と隠れた結合を発見せよ
- 外部システムとの接点を特定せよ

### 4. コードパターンと品質評価
- 使用されているデザインパターンを識別せよ
- コーディング規約の遵守状況を確認せよ
- 潜在的な技術的負債を特定せよ

### 5. 拡張性と保守性の分析
- 単一責任原則の遵守度を評価せよ
- テストカバレッジと品質を確認せよ
- 推奨されるリファクタリング手順を策定せよ

## 完了条件

タスクの完了条件は以下の通りとする。
完了条件、または次の項目で述べる中断条件を満たすまで作業を継続すること。

### 必須成果物
1. **実装概要レポート**
   - 対象実装の目的と責務の明文化
   - アーキテクチャ図またはフロー図の作成
   - 主要コンポーネントの一覧と説明

2. **技術的詳細文書**
   - 依存関係グラフ（内部/外部）
   - パフォーマンス特性の分析結果
   - セキュリティ考慮事項の列挙

3. **改善提案書**
   - 優先度付きリファクタリング項目
   - 推定工数と影響範囲の明記
   - 段階的実装計画の提示

### 品質基準
- すべてのコード参照がpermalink形式である
- 定量的指標が3つ以上含まれている
- 実装者以外でも理解可能な説明である

## 実行規約

タスクの実行中は常に以下の規約に従え。

### 調査手法
- 静的解析を優先し、必要に応じて動的解析を併用せよ
- git履歴から実装の経緯と意図を読み取れ
- テストコードから仕様と期待される振る舞いを推測せよ

### 報告形式
- コード参照には必ずGitHubのpermalink形式（コミットハッシュ付き）を使用せよ
- 重要度に応じて情報を階層化せよ
- 図表やコード例を適切に活用せよ
- 実践的な改善提案を含めよ

### 品質基準
- 客観的事実と主観的評価を明確に区別せよ
- 定量的指標を可能な限り提供せよ
- 複数の観点から多角的に分析せよ

## 中断条件

以下の条件を満たした場合は作業を中断し、その旨を報告すること。
また、現在の状況と残タスクを簡潔にまとめて提示すること。

- 作業を繰り返す中で、進捗が認められなくなった場合
- 調査対象が存在しない、または特定できない場合
- 必要な権限やアクセスが不足している場合

## 禁止事項

- タスクに直接関係しないファイルの変更を禁じる
- 調査対象外のコードの詳細分析を禁じる

## 補足事項

タスクに関する補足事項を以下に示す。

### 調査の優先順位
1. ビジネスロジックの中核部分
2. 頻繁に変更される部分
3. 複雑度が高い部分
4. 外部連携部分

### 出力形式の推奨
- Markdownフォーマットで構造化
- コードブロックには言語指定を含める
- mermaid記法での図表作成を推奨
- 重要な発見事項は強調表示

### 効率化のヒント
- パターンマッチングで類似実装を一括検索
- git blameで変更頻度の高い箇所を特定
- テストファイルから仕様を逆引き
- 既存のドキュメントやコメントを活用

- タスクを実行するにあたり、その円滑な進行を妨げる点(不明瞭な指示、必要不可欠な情報の欠損など)がある場合は、その旨をユーザーに報告し、追加の情報を求めよ
