---
description: 失敗テストを分析・修正し成功させる
argument-hint: <test-path | test-command>
---

## 前提・背景

- $ARGUMENTSで指定されたテストが失敗状態にある
- 失敗原因：実装不具合、テスト欠陥、環境要因のいずれか

## タスク

実行するべきタスクを以下に示す。
内容をよく読み、複数並行して進められると判断した場合は、並行して実行すること。

- テストを実行し、エラー詳細を分析せよ
- スタックトレースから失敗箇所と根本原因を特定せよ
- テストの意図を理解し、本質的修正を実装せよ
- 全関連テストの成功を確認せよ
- TodoWriteで各試行を追跡管理せよ

## 完了条件

タスクの完了条件は以下の通りとする。
完了条件、または次の項目で述べる中断条件を満たすまで作業を継続すること。

- 指定テストの成功
- 関連テストでの新規失敗なし

## 実行規約

タスクの実行中は常に以下の規約に従え。

- 完全なコマンドログを記録せよ
- 根本原因に焦点を当てよ（表面的症状ではなく）
- 最小限の変更に留めよ（不要なリファクタリング禁止）
- 修正前に意図と期待効果を明示せよ
- 失敗時は異なるアプローチを試みよ

## 中断条件

以下の条件を満たした場合は作業を中断し、その旨を報告すること。
また、現在の状況と残タスクを簡潔にまとめて提示すること。

- 進捗停滞時
- 5回試行後も失敗継続時
- 環境固有問題で修正不可能時

## 禁止事項

- タスクに直接関係しないファイルの変更を禁じる
- テスト無効化（スキップ、コメントアウト）を禁じる
- 期待値の安易な変更を禁じる
- テスト削除を禁じる
- 根本原因未特定での試行錯誤を禁じる

## 補足事項

タスクに関する補足事項を以下に示す。

- 進行阻害要因（不明瞭な指示、情報欠損等）は即座に報告し追加情報を求めよ
- 中断時は詳細レポート（試行履歴、根本問題、推奨次ステップ）を作成せよ
- テスト環境情報が不足時は積極的に調査せよ
